name: Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  lint-and-build:
    name: Lint and Build
    timeout-minutes: 15
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      with:
        lfs: true

    - name: Setup Bun
      uses: oven-sh/setup-bun@v2
      with:
        bun-version: latest

    - name: Install dependencies
      run: |
        cd nextjs
        bun install --frozen-lockfile

    - name: Run linting
      run: |
        cd nextjs
        bun run lint

    - name: Run type check
      run: |
        cd nextjs
        bunx tsc --noEmit

    - name: Build application
      env:
        # Dummy values for CI build - Supabase client requires these to be set
        NEXT_PUBLIC_SUPABASE_URL: https://placeholder.supabase.co
        NEXT_PUBLIC_SUPABASE_ANON_KEY: placeholder-anon-key
      run: |
        cd nextjs
        bun run build
